<!DOCTYPE html>
<html lang='en'>

<head>
  <meta charset='UTF-8' />
  <meta name='viewport' content='width=device-width, initial-scale=1.0' />
  <link rel='stylesheet' href='./medicine.css' />
  <link rel='stylesheet' href='../index.css'/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gridjs/dist/gridjs.umd.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />
  <title>Medicine Details</title>
  <style>
    #wrapper {
      width: 100%;
      margin: 20px;
    }
  
    .gridjs-table {
      width: 100%;
      border-collapse: collapse;
    }
  
    .gridjs-th,
    .gridjs-td {
      padding: 10px;
      text-align: left;
      border: 1px solid #ddd;
    }
  
    .gridjs-table th {
      background-color: #f2f2f2;
    }
  
    .gridjs-table td {
      background-color: #fff;
    }
  </style>
</head>

<body>
  <header class="text-bg-dark">
    <div class="container d-flex justify-content-center">
      <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
        <ul class=" nav col-12 col-lg-auto justify-content-center">
          <li><a href="../index.html" class="nav-link px-5 text-white border-li">Medicine</a></li>
          <!-- <li><a href="#" class="nav-link px-5 text-white border-li">Statistics</a></li> -->
          <li><a href="./records.html" class="nav-link px-5 text-white border-li">Records</a></li>
        </ul>
      </div>
    </div>
  </header>
  <section class=" p-5">
    <h1 id="name">ไม่พบในฐานข้อมูล </h1>
    <h5 class="inline-block">รหัสยา : &nbsp;
      <h5 class="inline-block" id="head-title">-</h5>
    </h5>
    <script> 
      let searchParams = new URLSearchParams(window.location.search)
      if (searchParams.has('ID')){
        let param = searchParams.get('ID')
        $(document).ready(function () {
          $("#head-title").text(param);  
        });
      }
    </script>
    <div>
      <h5 id="strID" class="inline-block">หมายเลขที่เก็บ : &nbsp;
        <h5 class="inline-block" id="head-title">-</h5>
      </h5>
      <br/>
      <h5 class="inline-block">คงเหลือ : &nbsp;
        <h5 class="inline-block" id="head-title">-</h5>
      </h5> 
    </div>
    <a href="./add_medicine.html"><button class="btn btn-success ">เพิ่มรายการขาย</button></a>
    <a id="forecast-link" href="./predict.html"><button class="btn btn-dark">พยากรณ์</button></a>
    <script>
      let searchParam = new URLSearchParams(window.location.search);
      let productID = searchParam.get('ID');

      if (productID) {
        let currentHref = $("#forecast-link").attr("href");
        let newHref = currentHref + "?ID=" + productID;
        $("#forecast-link").attr("href", newHref);
      }
    </script>
  </section>
  <div style="margin: 0 50px; overflow: scroll;">
  <div id="wrapper"></div>
  </div>
  <script>
    const test = new gridjs.Grid({
      columns: [
        "Invoice No", "Sale Date", "Sale Time", "Customer ID", "Drug Code", 
        "Product Name", "Batch No", "Storage Location", "Quantity", 
        "Unit", "Unit Price", "Total Amount", "Gross Profit"
      ],
      search: true,
      sort: true,
      resizable: true,
      pagination: true,
      data: () => {
        return new Promise(resolve => {
          fetch('http://127.0.0.1:8000/get-all-sales/')
            .then(response => response.json())
            .then(data => {
              let id = $("#head-title").text(); 
              $.each(data.data, function (index, row) {
                if (row.drug_code === id) {  
                  $("#name").text(row.product_name);  
                  return false;  
                }
              });

              const filteredRows = data.data.filter(row => row.drug_code === id)
                .map(row => [
                  row.invoice_no,
                  row.sale_date,
                  row.sale_time,
                  row.customer_id,
                  row.drug_code,
                  row.product_name,
                  row.batch_no,
                  row.storage_location,
                  row.quantity,
                  row.unit,
                  row.unit_price,
                  row.total_amount,
                  row.gross_profit
                ]);

              resolve(filteredRows);
            })
            .catch(error => {
              console.error('Error fetching data:', error);
              resolve([]); 
            });
        });
      }
    }).render(document.getElementById("wrapper"));
  </script>


  
  <script src="https://cdn.jsdelivr.net/npm/gridjs/dist/gridjs.umd.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />
</body>

</html>